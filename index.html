<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.ethers.io/scripts/ethers-v4.min.js" charset="utf-8" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/bignumber.js/9.0.1/bignumber.js"></script>

</head>

<body>
    Switch Network: <select id="switch" onchange="onSwitch(this.value)">
        <option value="fuji">fuji</option>
        <option value="kovan">kovan</option>
    </select>
    <br><br>
    Your Address:<input type="text" value="" id="youraddress" , style="width: 500px;"
        onchange="changeYourAddress(this.value)"><br>
    <br>
    ETH:<br>
    Address:<input type="text" value="" id="ETH" , style="width: 500px;" onchange="changeAddress('ETH',this.value)"><br>
    Amount:<input type="text" value="" id="AETH" , style="width: 500px;" onchange="changeAmount('ETH',this.value)">
    <br><br>
    LINK:<br>
    Address:<input type="text" value="" id="LINK" , style="width: 500px;"
        onchange="changeAddress('LINK',this.value)"><br>
    Amount:<input type="text" value="" id="ALINK" , style="width: 500px;" onchange="changeAmount('LINK',this.value)">
    <br><br>
    WBTC:<br>
    Address:<input type="text" value="" id="WBTC" , style="width: 500px;"
        onchange="changeAddress('WBTC',this.value)"><br>
    Amount:<input type="text" value="" id="AWBTC" , style="width: 500px;" onchange="changeAmount('WBTC',this.value)">
    <br><br>
    USDT:<br>
    Address:<input type="text" value="" id="USDT" , style="width: 500px;"
        onchange="changeAddress('USDT',this.value)"><br>
    Amount:<input type="text" value="" id="AUSDT" , style="width: 500px;" onchange="changeAmount('USDT',this.value)">
    <br><br>
    TUSD:<br>
    Address:<input type="text" value="" id="TUSD" , style="width: 500px;"
        onchange="changeAddress('TUSD',this.value)"><br>
    Amount:<input type="text" value="" id="ATUSD" , style="width: 500px;" onchange="changeAmount('TUSD',this.value)">
    <br><br>

    <button onclick="start()">发送</button>
    <script>
        BigNumber.config({ EXPONENTIAL_AT: [-18, 100] })
        let network = "fuji"
        const networks = {
            "fuji": {
                "name": "Avalanche Fuji C-Chain",
                "chainId": 43113,
                "ensAddress": "",
                "_defaultProvider": "https://api.avax-test.network/ext/bc/C/rpc"
            },
            "kovan": {
                "name": "Ethereum Kovan Test Net",
                "chainId": 42,
                "ensAddress": "",
                "_defaultProvider": "https://kovan.infura.io/v3/d45c150dbef446ea9a5453cb0ad89bb6"
            }
        }

        const dataRecord = {
            "env": "fuji",
            "deployer_address": "0x85f4f02b9FB17196c2E2678F106A76bd435af8DA",
            "deploy_date": "2021-6-30  14:3:21",
            "CompoundLensAddress": "0xa8537eE4C3ea6c9757DF43f2C394FF7029400116",
            "UnitrollerAddress": "0x52799FE9be40486b58e1F10c04B2CE412452d5F6",
            "USDTInterestModelAddress": "0x9916C0366d43734228A45c92c67921e4A8258653",
            "UNIInterestModelAddress": "0xF2cfdCb98450Cb343BaF6de96b615270991f42ae",
            "ETHInetrestModelAddress": "0x261aC89D644a02f29323092cF342f91906aA33b2",
            "BTCInterestModelAddress": "0x23489B1C67069212b225a0dc6a25f3DD2a721f08",
            "ComptrollerAddress": "0x56c32981409200E96300938895bb402aEC482eCA",
            "UniswapAnchoredViewAddress": "0x95e781D306334B2ff637EC4144410B5b27864B5F",
            "OpenPriceOracleAddress": "0x3547Caf7e8f05aa4A5c8F68C2BC0077973059AF5",
            "WAVAX": "0xd00ae08403B9bbb9124bB305C09058E32C39A48c",
            "VEE": "0xb75a80ED9d41D4fd57414645544D79020EF843C3",
            "VeeHelper": "0x3457c8623CaF644c3B6F809B5dcF094443C0B0a9",
            "Router": "0x2D99ABD9008Dc933ff5c0CD271B88309593aB921",
            "VeeProxyController": "0xA8E9228218061C58E1df57885aA25d5e898F7720",
            "ProxyAdmin": "0x948aa0cfc01bAA2DEea43330bA9716497Ec1646C",
            "AdminUpgradeabilityProxy": "0x9871aCF356240f8B8b63B115eAF8c1949949F221",
            "SwapHelper": "0xd5Ce22AE8A1d3E014FB3f347D4ADB0c9F041AA6A",
            "AVAXMarket": "0x32e99c4b59316f285eaa9ba202a109421f9b87d0",
            "ETHMarket": "0x8ff119a4607857eb6190d5bd2c118d44e638ffb8",
            "LINKMarket": "0xcbcf8370f22041587959750b96ade1d828ba511b",
            "WBTCMarket": "0xc9ab446d93fa4cb5fb131be0bde37fbf7c585d16",
            "erc20Address": {
                "ETH": "0xdb456F6112F68b1F22aeD4fB5a1d58A91D292F40",
                "LINK": "0x83eE4DA0ac6557bD3B7439FD28C0A7ed77C73c4e",
                "WBTC": "0xc4a8272248A5233aC3359D4BC100bC671EBdE4Cd",
                "USDT": "0xFe143522938e253e5Feef14DB0732e9d96221D72",
                "TUSD": "0x8f448E6733415143AedDaA24D1B9dB71e97f3a2d"
            },
            "cTokenAddress": {
                "veAVAX": "0xA048B6a5c1be4b81d99C3Fd993c98783adC2eF70",
                "veETH": "0x5224Ac3e6e0BF58219CF4156fD0CB10B71200FB6",
                "veLINK": "0xFB1f9CfaB605c3a57A27684Ce1b5AC8F7353F477",
                "veWBTC": "0xf7b6DA8af88F0dE5cA626995760f5031d0d1A424",
                "veUSDT": "0x090c90De60Dff7C885409dC9e6F2F25B73C0CE2B",
                "veTUSD": "0x7d046A02B03ff37C15087a1168d671422b463731"
            }
        }

        let abiErc20 = [
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Approval",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Transfer",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_owner",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "allocateTo",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    }
                ],
                "name": "allowance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "approve",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "account",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalSupply",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transfer",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "sender",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ]

        let tokens = {
            ETH: {
                address: dataRecord.erc20Address.ETH,
                amount: "100",
                decimals: "1e18"
            },
            LINK: {
                address: dataRecord.erc20Address.LINK,
                amount: "100",
                decimals: "1e18"
            },
            WBTC: {
                address: dataRecord.erc20Address.WBTC,
                amount: "100",
                decimals: "1e8"
            },
            USDT: {
                address: dataRecord.erc20Address.USDT,
                amount: "100",
                decimals: "1e6"
            },
            TUSD: {
                address: dataRecord.erc20Address.TUSD,
                amount: "100",
                decimals: "1e18"
            }
        }

        for (let key in tokens) {
            document.getElementById(key).value = tokens[key].address
            document.getElementById(`A${key}`).value = tokens[key].amount
        }

        // let myAddress = "0x85f4f02b9FB17196c2E2678F106A76bd435af8DA"
        let privateKey = "6772dc2cf08f04a5c15c2cc863d6a02f94f6c426d5a4b0349cbb277322fd9571"
        let yourAddress
        let nonce
        async function start() {
            if (!yourAddress) {
                alert("请输入你的地址")
                return
            }
            let provider = new ethers.providers.JsonRpcProvider(networks[network]._defaultProvider, networks[network]);
            let wallet = new ethers.Wallet(privateKey, provider);
            nonce = await wallet.getTransactionCount()
            console.log("===========开始============")
            for (let key in tokens) {
                await allocateToken(provider, wallet, key)
            }
            console.log("==========结束============")
        }

        async function allocateToken(provider, wallet, key) {

            let erc20Contract = new ethers.Contract(tokens[key].address, abiErc20, provider)
            let erc20 = erc20Contract.connect(wallet)
            let amount = new BigNumber(tokens[key].amount).multipliedBy(new BigNumber(tokens[key].decimals)).toString()
            console.log("amount=======>" + amount)
            let tx = await erc20.allocateTo(yourAddress, amount, { nonce: nonce })
            console.log("txHash:" + tx.hash)
            nonce++

        }

        function changeAddress(key, address) {
            tokens[key].address = address
        }

        function changeAmount(key, amount) {
            // tokens[key].amount = new BigNumber(amount).multipliedBy(new BigNumber(tokens[key].decimals)).toString()
            tokens[key].amount = amount
        }

        function changeYourAddress(address) {
            yourAddress = address
        }

        function onSwitch(value) {
            network = value
        }

    </script>
</body>

</html>