<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.ethers.io/scripts/ethers-v4.min.js" charset="utf-8" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/bignumber.js/9.0.1/bignumber.js"></script>

</head>

<body>
    Switch Network: <select id="switch" onchange="onSwitch(this.value)">
        <option value="fuji">fuji</option>
        <option value="kovan">kovan</option>
    </select>
    <br><br>
    Your Address:<input type="text" value="" id="youraddress" , style="width: 500px;"
        onchange="changeYourAddress(this.value)"><br>
    <br>
    ETH:<br>
    Address:<input type="text" value="" id="ETH" , style="width: 500px;" onchange="changeAddress('ETH',this.value)"><br>
    Amount:<input type="text" value="" id="AETH" , style="width: 500px;" onchange="changeAmount('ETH',this.value)">
    <br><br>
    LINK:<br>
    Address:<input type="text" value="" id="LINK" , style="width: 500px;"
        onchange="changeAddress('LINK',this.value)"><br>
    Amount:<input type="text" value="" id="ALINK" , style="width: 500px;" onchange="changeAmount('LINK',this.value)">
    <br><br>
    WBTC:<br>
    Address:<input type="text" value="" id="WBTC" , style="width: 500px;"
        onchange="changeAddress('WBTC',this.value)"><br>
    Amount:<input type="text" value="" id="AWBTC" , style="width: 500px;" onchange="changeAmount('WBTC',this.value)">
    <br><br>
    USDT:<br>
    Address:<input type="text" value="" id="USDT" , style="width: 500px;"
        onchange="changeAddress('USDT',this.value)"><br>
    Amount:<input type="text" value="" id="AUSDT" , style="width: 500px;" onchange="changeAmount('USDT',this.value)">
    <br><br>
    TUSD:<br>
    Address:<input type="text" value="" id="TUSD" , style="width: 500px;"
        onchange="changeAddress('TUSD',this.value)"><br>
    Amount:<input type="text" value="" id="ATUSD" , style="width: 500px;" onchange="changeAmount('TUSD',this.value)">
    <br><br>

    <button onclick="start()">发送</button>
    <script>
        BigNumber.config({ EXPONENTIAL_AT: [-18, 100] })
        let network = "fuji"
        const networks = {
            "fuji": {
                "name": "Avalanche Fuji C-Chain",
                "chainId": 43113,
                "ensAddress": "",
                "_defaultProvider": "https://api.avax-test.network/ext/bc/C/rpc"
            },
            "kovan": {
                "name": "Ethereum Kovan Test Net",
                "chainId": 42,
                "ensAddress": "",
                "_defaultProvider": "https://kovan.infura.io/v3/d45c150dbef446ea9a5453cb0ad89bb6"
            }
        }

        const dataRecord = {
            "env": "fuji",
            "deployer_address": "0x85f4f02b9FB17196c2E2678F106A76bd435af8DA",
            "deploy_date": "2021-6-22  20:52:5",
            "CompoundLensAddress": "0x205Cf5a2eFae68a9378F74543885E87c6aA7a38F",
            "UnitrollerAddress": "0xE17404aC8B23cBFe53955d91FC9be8CB8221c9C7",
            "USDTInterestModelAddress": "0x5f7A6b8483868308AC0d64ab06b16928d09d5977",
            "UNIInterestModelAddress": "0x6F46ce9eD4856894dF796B081a80EFe3Bf108BA5",
            "ETHInetrestModelAddress": "0x4B9EbEAeee48904df51d28463D61885128C3fDa8",
            "BTCInterestModelAddress": "0x4777F567aeEAD908D44e50461a48e8014366039F",
            "ComptrollerAddress": "0xB4561F21b55f7070d1F089908CF11De40Bd07B51",
            "UniswapAnchoredViewAddress": "0xD28E716406c4b31a67Bb01e6DC85b296360e5498",
            "OpenPriceOracleAddress": "0x7DD63cF227037cBDAd95080D14E16FA31489c49e",
            "WAVAX": "0xd00ae08403B9bbb9124bB305C09058E32C39A48c",
            "VeeProxyController": "0xDa3A7496bDd214888A235514Fba46dFcd2f2Cb32",
            "ProxyAdmin": "0x72a5E441261c66B91b5e25FA8ad15B80451f72B9",
            "AdminUpgradeabilityProxy": "0xD5b38806BF9F8f3A42aE5C5f2705f05B7269C727",
            "SwapHelper": "0x0BE549eCd2CA75fe08A961a13d3555540C5eB7ea",
            "AVAXMarket": "0xf4b6bbd2c21b8853ff7087345755cbe96ec8c83d",
            "ETHMarket": "0x1f799936a2069a47b930ec791c17b6b44a8f8f5a",
            "LINKMarket": "0xd2e79d92d6d0587c0a5df653df79e8e3e10e0439",
            "WBTCMarket": "0xa0059ff009ea4b822c22ec86cb584c2e3d99c143",
            "erc20Address": {
                "ETH": "0x2113FEFC4613417e032D5cD4E4548895aD9dcc08",
                "LINK": "0xD7c0c2fc82A1ba1568f0c0D95d3010E48f4aA3e5",
                "WBTC": "0xf9829608d8BA648FEfba5C3343C2b9847f330A82",
                "USDT": "0xf1B6F21d075eBD4c1F2C9124B4Ee96f9EA3eCe5d",
                "TUSD": "0x745e442f6F5b2936F5a6214884c471449617516D"
            },
            "cTokenAddress": {
                "veAVAX": "0xf2D3a303Fc0638957754Aa720d9BaaA8f218e6c0",
                "veETH": "0x48caad45c6736b8F40a10761AE56D9E33CCd6527",
                "veLINK": "0x8F4f3eA8162886E25c9b30CaaA2059F9191b0B50",
                "veWBTC": "0x0c2a557Ae66617aC09aE5D04C736b3189470c40b",
                "veUSDT": "0xB18694a0dfE204939695534B847b7c902629971b",
                "veTUSD": "0xE329B306f2691fA684F5BaD1B3ADffC3a2c16395"
            }
        }

        let abiErc20 = [
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Approval",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Transfer",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_owner",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "allocateTo",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    }
                ],
                "name": "allowance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "approve",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "account",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalSupply",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transfer",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "sender",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ]

        let tokens = {
            ETH: {
                address: dataRecord.erc20Address.ETH,
                amount: "100",
                decimals: "1e18"
            },
            LINK: {
                address: dataRecord.erc20Address.LINK,
                amount: "100",
                decimals: "1e18"
            },
            WBTC: {
                address: dataRecord.erc20Address.WBTC,
                amount: "100",
                decimals: "1e8"
            },
            USDT: {
                address: dataRecord.erc20Address.USDT,
                amount: "100",
                decimals: "1e6"
            },
            TUSD: {
                address: dataRecord.erc20Address.TUSD,
                amount: "100",
                decimals: "1e18"
            }
        }

        for (let key in tokens) {
            document.getElementById(key).value = tokens[key].address
            document.getElementById(`A${key}`).value = tokens[key].amount
        }

        // let myAddress = "0x85f4f02b9FB17196c2E2678F106A76bd435af8DA"
        let privateKey = "6772dc2cf08f04a5c15c2cc863d6a02f94f6c426d5a4b0349cbb277322fd9571"
        let yourAddress
        let nonce
        async function start() {
            if (!yourAddress) {
                alert("请输入你的地址")
                return
            }
            let provider = new ethers.providers.JsonRpcProvider(networks[network]._defaultProvider, networks[network]);
            let wallet = new ethers.Wallet(privateKey, provider);
            nonce = await wallet.getTransactionCount()
            console.log("===========开始============")
            for (let key in tokens) {
                await allocateToken(provider, wallet, key)
            }
            console.log("==========结束============")
        }

        async function allocateToken(provider, wallet, key) {

            let erc20Contract = new ethers.Contract(tokens[key].address, abiErc20, provider)
            let erc20 = erc20Contract.connect(wallet)
            let amount = new BigNumber(tokens[key].amount).multipliedBy(new BigNumber(tokens[key].decimals)).toString()
            console.log("amount=======>" + amount)
            let tx = await erc20.allocateTo(yourAddress, amount, { nonce: nonce })
            console.log("txHash:" + tx.hash)
            nonce++

        }

        function changeAddress(key, address) {
            tokens[key].address = address
        }

        function changeAmount(key, amount) {
            // tokens[key].amount = new BigNumber(amount).multipliedBy(new BigNumber(tokens[key].decimals)).toString()
            tokens[key].amount = amount
        }

        function changeYourAddress(address) {
            yourAddress = address
        }

        function onSwitch(value) {
            network = value
        }

    </script>
</body>

</html>