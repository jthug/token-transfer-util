<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.ethers.io/scripts/ethers-v4.min.js" charset="utf-8" type="text/javascript"></script>
    <script type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/bignumber.js/9.0.1/bignumber.js"></script>

</head>

<body>
    Switch Network: <select id="switch" onchange="onSwitch(this.value)">
        <option value="fuji">fuji</option>
        <option value="kovan">kovan</option>
    </select>
    <br><br>
    Your Address:<input type="text" value="" id="youraddress" , style="width: 500px;"
        onchange="changeYourAddress(this.value)"><br>
    <br>
    ETH:<br>
    Address:<input type="text" value="" id="ETH" , style="width: 500px;" onchange="changeAddress('ETH',this.value)"><br>
    Amount:<input type="text" value="" id="AETH" , style="width: 500px;" onchange="changeAmount('ETH',this.value)">
    <br><br>
    LINK:<br>
    Address:<input type="text" value="" id="LINK" , style="width: 500px;"
        onchange="changeAddress('LINK',this.value)"><br>
    Amount:<input type="text" value="" id="ALINK" , style="width: 500px;" onchange="changeAmount('LINK',this.value)">
    <br><br>
    WBTC:<br>
    Address:<input type="text" value="" id="WBTC" , style="width: 500px;"
        onchange="changeAddress('WBTC',this.value)"><br>
    Amount:<input type="text" value="" id="AWBTC" , style="width: 500px;" onchange="changeAmount('WBTC',this.value)">
    <br><br>
    USDT:<br>
    Address:<input type="text" value="" id="USDT" , style="width: 500px;"
        onchange="changeAddress('USDT',this.value)"><br>
    Amount:<input type="text" value="" id="AUSDT" , style="width: 500px;" onchange="changeAmount('USDT',this.value)">
    <br><br>
    TUSD:<br>
    Address:<input type="text" value="" id="TUSD" , style="width: 500px;"
        onchange="changeAddress('TUSD',this.value)"><br>
    Amount:<input type="text" value="" id="ATUSD" , style="width: 500px;" onchange="changeAmount('TUSD',this.value)">
    <br><br>

    <button onclick="start()">发送</button>
    <script>
        BigNumber.config({ EXPONENTIAL_AT: [-18, 100] })
        let network = "fuji"
        const networks = {
            "fuji": {
                "name": "Avalanche Fuji C-Chain",
                "chainId": 43113,
                "ensAddress": "",
                "_defaultProvider": "https://api.avax-test.network/ext/bc/C/rpc"
            },
            "kovan": {
                "name": "Ethereum Kovan Test Net",
                "chainId": 42,
                "ensAddress": "",
                "_defaultProvider": "https://kovan.infura.io/v3/d45c150dbef446ea9a5453cb0ad89bb6"
            }
        }

        const dataRecord = {
            "env": "fuji",
            "deployer_address": "0x85f4f02b9FB17196c2E2678F106A76bd435af8DA",
            "deploy_date": "2021-6-25  17:18:33",
            "CompoundLensAddress": "0x89974991245A9133ccc6669eE3E5D6A900659445",
            "UnitrollerAddress": "0x89b81ac6D63E3320D527D9053217cF4f44f0Fa6e",
            "USDTInterestModelAddress": "0x14d56F52Be9a3b714b4b6B744C44FBA46b5391Ab",
            "UNIInterestModelAddress": "0x9D61b393DA9680106e288974D57300FEA26f1475",
            "ETHInetrestModelAddress": "0x3A7f8065Da667B97390CC6C140F26247463c4B05",
            "BTCInterestModelAddress": "0xbE68b9FaE6Edf5D7696ABDe6b33f755baA58f146",
            "ComptrollerAddress": "0x9580C25Aa3058E09a19f8E2f74b728e428D8794E",
            "UniswapAnchoredViewAddress": "0xe8cfCdb4f7Ee0D02F3A3CD0D709f171349758C29",
            "OpenPriceOracleAddress": "0x61d451B057835262b74Fe2A8F3aB29287cEdD1e1",
            "WAVAX": "0xd00ae08403B9bbb9124bB305C09058E32C39A48c",
            "VeeProxyController": "0x276664801F847E358c848e4bDa082384dB1349D8",
            "ProxyAdmin": "0x15abC934F376392c116aA699163f639F3758E377",
            "AdminUpgradeabilityProxy": "0x17aF4029521Fa36b6b358416c1AE62ADeA0C23b2",
            "SwapHelper": "0x54e93F9B3c68c5C82ab45f2779C60b498dD1093B",
            "AVAXMarket": "0x471a3e49a295846bb20fe64b436a42eb09f609ce",
            "ETHMarket": "0x40389a0c6e743e513e9408e9a4e3870e671bd5ab",
            "LINKMarket": "0x618b8fe87353fab26502d9882684cf9a7078960a",
            "WBTCMarket": "0xc048a937fd5a26d0183d35f2b6d4684c73a319fd",
            "erc20Address": {
                "ETH": "0x648C1243Bd9AD6a241cF351c941e54919a23C589",
                "LINK": "0x79b59791Fd5Be292cB1eE5d0d1814F4bb556cF99",
                "WBTC": "0x33121664838597c80CD1EB175B85a2c7bbFAf1F9",
                "USDT": "0xd622124bAFFd5726a4EF3982E09288f612418BF4",
                "TUSD": "0x1f6a6E6b232c69c8E7F0511048a030c78264bDab"
            },
            "cTokenAddress": {
                "veAVAX": "0xF023DB7edFfb000F76bcc3aCa2D2eFCd329B9307",
                "veETH": "0x02874d21d877Bb1885E40E4d37F53C5feCc01946",
                "veLINK": "0xe1abA18E1a2ABC0A8d86F39a85e9Af95671BEa62",
                "veWBTC": "0x3B66141811fB92F65281022C4A903CaE19711938",
                "veUSDT": "0x4F776840eEC833264277116FeB0A5Fb1077c3408",
                "veTUSD": "0xaaF6fac42e328564a653989B681BFDC6520d62e6"
            }
        }

        let abiErc20 = [
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Approval",
                "type": "event"
            },
            {
                "anonymous": false,
                "inputs": [
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "from",
                        "type": "address"
                    },
                    {
                        "indexed": true,
                        "internalType": "address",
                        "name": "to",
                        "type": "address"
                    },
                    {
                        "indexed": false,
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "Transfer",
                "type": "event"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "_owner",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "value",
                        "type": "uint256"
                    }
                ],
                "name": "allocateTo",
                "outputs": [],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "owner",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    }
                ],
                "name": "allowance",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "spender",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "approve",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "account",
                        "type": "address"
                    }
                ],
                "name": "balanceOf",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "totalSupply",
                "outputs": [
                    {
                        "internalType": "uint256",
                        "name": "",
                        "type": "uint256"
                    }
                ],
                "stateMutability": "view",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transfer",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [
                    {
                        "internalType": "address",
                        "name": "sender",
                        "type": "address"
                    },
                    {
                        "internalType": "address",
                        "name": "recipient",
                        "type": "address"
                    },
                    {
                        "internalType": "uint256",
                        "name": "amount",
                        "type": "uint256"
                    }
                ],
                "name": "transferFrom",
                "outputs": [
                    {
                        "internalType": "bool",
                        "name": "",
                        "type": "bool"
                    }
                ],
                "stateMutability": "nonpayable",
                "type": "function"
            }
        ]

        let tokens = {
            ETH: {
                address: dataRecord.erc20Address.ETH,
                amount: "100",
                decimals: "1e18"
            },
            LINK: {
                address: dataRecord.erc20Address.LINK,
                amount: "100",
                decimals: "1e18"
            },
            WBTC: {
                address: dataRecord.erc20Address.WBTC,
                amount: "100",
                decimals: "1e8"
            },
            USDT: {
                address: dataRecord.erc20Address.USDT,
                amount: "100",
                decimals: "1e6"
            },
            TUSD: {
                address: dataRecord.erc20Address.TUSD,
                amount: "100",
                decimals: "1e18"
            }
        }

        for (let key in tokens) {
            document.getElementById(key).value = tokens[key].address
            document.getElementById(`A${key}`).value = tokens[key].amount
        }

        // let myAddress = "0x85f4f02b9FB17196c2E2678F106A76bd435af8DA"
        let privateKey = "6772dc2cf08f04a5c15c2cc863d6a02f94f6c426d5a4b0349cbb277322fd9571"
        let yourAddress
        let nonce
        async function start() {
            if (!yourAddress) {
                alert("请输入你的地址")
                return
            }
            let provider = new ethers.providers.JsonRpcProvider(networks[network]._defaultProvider, networks[network]);
            let wallet = new ethers.Wallet(privateKey, provider);
            nonce = await wallet.getTransactionCount()
            console.log("===========开始============")
            for (let key in tokens) {
                await allocateToken(provider, wallet, key)
            }
            console.log("==========结束============")
        }

        async function allocateToken(provider, wallet, key) {

            let erc20Contract = new ethers.Contract(tokens[key].address, abiErc20, provider)
            let erc20 = erc20Contract.connect(wallet)
            let amount = new BigNumber(tokens[key].amount).multipliedBy(new BigNumber(tokens[key].decimals)).toString()
            console.log("amount=======>" + amount)
            let tx = await erc20.allocateTo(yourAddress, amount, { nonce: nonce })
            console.log("txHash:" + tx.hash)
            nonce++

        }

        function changeAddress(key, address) {
            tokens[key].address = address
        }

        function changeAmount(key, amount) {
            // tokens[key].amount = new BigNumber(amount).multipliedBy(new BigNumber(tokens[key].decimals)).toString()
            tokens[key].amount = amount
        }

        function changeYourAddress(address) {
            yourAddress = address
        }

        function onSwitch(value) {
            network = value
        }

    </script>
</body>

</html>